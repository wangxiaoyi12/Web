@using DataBase
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}
@{
    var account = ViewData["CurrentUser"] as Account;
    var member = ViewData["member"] as Member_Info;
}
<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="Index">首页</a>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
<!-- BEGIN PAGE TITLE-->
<h3 class="page-title">
    <span class="red">@account.Name</span> 您好
    <small>欢迎登录 @(DB.XmlConfig.XmlSite.webname)</small>
</h3>
<!-- END PAGE TITLE-->
<!-- END PAGE HEADER-->
<!-- BEGIN DASHBOARD STATS 1-->
<div class="row">
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 blue" href="#">
            <div class="visual">
                <i class="fa fa-sitemap"></i>
            </div>
            <div class="details">
                <div class="number">
                    @member.MemberLevelName
                </div>
                <div class="desc"> 会员级别 </div>
            </div>
        </a>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 red" href="#">
            <div class="visual">
                <i class="fa fa-male"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@Convert.ToInt32(ViewData["sum"])">0</span>人
                </div>
                <div class="desc"> 已推荐人数 </div>
            </div>
        </a>
    </div>
    @*<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 red" href="#">
            <div class="visual">
                <i class="fa fa-male"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@Convert.ToInt32(ViewData["Dian"])">0</span>人
                </div>
                <div class="desc"> 推荐店数量 </div>
            </div>
        </a>
    </div>*@
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 green" href="#">
            <div class="visual">
                <i class="fa fa-rmb"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@(member.Commission<0?0:member.Commission)">0</span>￥
                </div>
                <div class="desc"> 收益余额 </div>
            </div>
        </a>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 purple" href="#">
            <div class="visual">
                <i class="fa fa-rmb"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@(member.Coins<0?0:member.Coins)">0</span>￥
                </div>
                <div class="desc"> 报单积分余额 </div>
            </div>
        </a>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 blue" href="#">
            <div class="visual">
                <i class="fa fa-btc"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@(member.ShopCoins<0?0:member.ShopCoins)">0</span>
                </div>
                <div class="desc"> 推广奖余额 </div>
            </div>
        </a>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 blue" href="#">
            <div class="visual">
                <i class="fa fa-btc"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@(member.Scores<0?0:member.Scores)">0</span>
                </div>
                <div class="desc"> 配货价余额 </div>
            </div>
        </a>
    </div>
    @*<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <a class="dashboard-stat dashboard-stat-v2 blue" href="#">
            <div class="visual">
                <i class="fa fa-btc"></i>
            </div>
            <div class="details">
                <div class="number">
                    <span data-counter="counterup" data-value="@(member.TourScores<0?0:member.TourScores)">0</span>
                </div>
                <div class="desc"> 商城积分余额 </div>
            </div>
        </a>
    </div>*@
</div>
<div class="clearfix"></div>
<!-- END DASHBOARD STATS 1-->

<div class="row">
    <div class="col-md-6 col-sm-6">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-red-intense">
                    <i class="fa fa-newspaper-o  font-red-intense"></i>
                    <span class="caption-subject bold uppercase text-center">新闻公告</span>
                </div>
            </div>
            <div class="portlet-body">
                <div class="scroller" style="height: 300px;" data-always-visible="1" data-rail-visible="0">
                    <ul class="feeds">
                        @{
                            foreach (var item in ViewData["news"] as List<News_Info>)
                            {
                                <text>
                                    <li>
                                        <div class="col1">
                                            <div class="cont">
                                                <div class="cont-col1">
                                                    <div class="label label-sm label-info">
                                                        <i class="fa fa-newspaper-o"></i>
                                                    </div>
                                                </div>
                                                <div class="cont-col2">
                                                    <div class="desc">
                                                        <a href="/Member_Infos/NewsInfo/Detail/@item.NewsId?commentForm=commentForm">
                                                            @item.Title
                                                        </a>
                                                        <span class="label label-sm label-success" title="作者" style="cursor:pointer;">
                                                            <i class="fa fa-paint-brush"></i>
                                                            @item.CreateEmpName
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col2">
                                            <div class="date" style="cursor:pointer;" title="浏览量">@item.ReadNum </div>
                                        </div>
                                    </li>
                                </text>
                            }
                        }
                    </ul>
                </div>
                <div class="scroller-footer">
                    <div class="btn-arrow-link pull-right">
                        <a href="/Member_Infos/NewsInfo/Index">更多</a>
                        <i class="fa fa-ellipsis-v"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-sm-6">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-red-intense">
                    <i class="fa fa-bar-chart-o font-red-intense"></i>
                    <span class="caption-subject bold uppercase text-center">本周收益统计</span>
                </div>
                <div class="tools">
                    <a href="" class="remove" data-original-title="" title=""> </a>
                </div>
            </div>
            <div class="portlet-body">
                <div id="context2" style="width: 100%;height:329px;" data-toggle="context" data-target="#context-menu">
                    <div id="PerformanceToBar" style="width: 100%;height:329px;"></div>
                </div>
            </div>
        </div>
    </div>
    @{
        var url = Request.Url.AbsoluteUri.ToString().Replace("SysManage/Desk/Index", "") + "Reg/" + account.LoginName;
        //var url = Url_Mobile.GetQrCodeLink(member);
    }
    <dov class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-red-intense">
                    <i class="fa fa-bar-chart-o font-red-intense"></i>
                    <span class="caption-subject bold uppercase text-center">我要推广</span>
                </div>
                <div class="tools">
                </div>
            </div>
            <div class="portlet-body">
                <div class="">
                    <p>
                        推广链接：<a href="@url" target="_blank">@url</a>
                        <button id="copyURL" type="button" aria-label="复制成功！" data-url="@url" class="btn btn-primary">复制</button>
                    </p>
                    <div class="col-xs-6">
                        <h5> 推广二维码：</h5>
                        <div id="code"></div>
                    </div>
                    @*<div class="col-xs-6">
                        <h5> 推广名片：(注，右键可以下载到本地)</h5>
                        <div id="code2"></div>
                        <canvas id="cardCanvas" style="border:1px solid red;display:none"></canvas>
                        <img id="card" style="max-width:100%;" />
                    </div>*@
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </dov>
</div>
@section scripts {
    @*<script src="/assets/global/plugins/counterup/jquery.waypoints.min.js" type="text/javascript"></script>
        <script src="/assets/global/plugins/counterup/jquery.counterup.min.js" type="text/javascript"></script>
        <script src="/assets/global/plugins/bootstrap-contextmenu/bootstrap-contextmenu.js" type="text/javascript"></script>
        <script src="~/assets/pages/scripts/components-context-menu.js"></script>*@
    <script src="~/assets/global/plugins/jquery-qrcode/jquery.qrcode.min.js"></script>
    @*<script src="~/assets/global/plugins/jquery.zclip/jquery.zclip.min.js"></script>*@
    <script src="/assets/echart/echarts.min.js" type="text/javascript"></script>
    <script src="~/assets/global/plugins/jquery.zclip/clipboard.min.js"></script>
    <script type="text/javascript">
        //任意字符串 生成二维码
        //默认使用Canvas画图
        $('#code').qrcode('@url');

        (function () {
            //生成，推广图片
            var canvas = document.getElementById('cardCanvas');
            var ctx = canvas.getContext('2d');

            var templateurl = '/assets/mobile/img/template.jpg';
            var template = new Image();
            template.onload = function () {
                canvas.width = template.width;
                canvas.height = template.height;
                //添加背景
                ctx.drawImage(template, 0, 0, template.width, template.height);

                //添加头像
                var logourl = '/SysManage/Desk/gettouxiang';
                var logo = new Image();
                logo.onload = function () {
                    logo.width = 100;
                    logo.height = 100;
                    ctx.drawImage(logo, 246, 112, logo.width, logo.height);
                    //添加昵称
                    ctx.font = 'normal 25px 微软雅黑';
                    ctx.fillStyle = '#f30100';
                    ctx.fillText('@member.NickName', 380, 170);
                    //添加二维码
                    getQrCode(function (img) {
                        // ctx.clearRect();
                        ctx.drawImage(img, 270, 530, img.width, img.height);
                        //绘制结算
                        $('#card').attr('src', canvas.toDataURL('image/png'));
                    });
                }
                logo.src = logourl;
            }
            template.src = templateurl;


            function getQrCode(onSucess) {
                var qrCanvas = $('#code').find('canvas')[0];
                var img = new Image();
                img.onload = function () {
                    img.width = 190;
                    img.height = 190;
                    onSucess(img);
                }
                img.src = qrCanvas.toDataURL('image/png');
            }
        })();

        $(document).ready(function () {
            PerformanceToBar();
        });

        var url = $("#copyURL").attr("data-url");
        var clipboard = new Clipboard('#copyURL', {
            text: function () {
                return url;
            }
        });
        clipboard.on('success', function (e) {
            var msg = e.trigger.getAttribute('aria-label');
            alert(msg);
            console.info('Action:', e.action);
            console.info('Text:', e.text);
            console.info('Trigger:', e.trigger);
            e.clearSelection();
        });
        @*$('#copyURL').zclip({
            path: '/assets/global/plugins/jquery.zclip/ZeroClipboard.swf',
            copy: "@url",
            afterCopy: function myfunction() {
                alert("推广链接复制成功，您可以直接粘贴到QQ/微信上发送给好友");
            }
        });*@

        $(document).ready(function () {
            PerformanceToBar();
        });
        /*
        * 本周销售业绩趋势图
        */
        function PerformanceToBar() {

            // ReSharper disable once DuplicatingLocalDeclaration
            var PerformanceToBar = echarts.init(document.getElementById("PerformanceToBar"));
            //构建option模板
            var PerformanceToBarOption = {
                title: {
                    text: "本周收益统计图",
                    textStyle: {
                        fontSize: 15
                    },

                    sublink: ""
                },
                tooltip: {
                    trigger: "axis"
                },
                legend: {
                    top: 5,
                    data: []
                },
                grid: {
                    show: true,
                    left: "3%",
                    right: "3%",
                    bottom: "3%",
                    containLabel: true
                },
                toolbox: {
                    show: true,
                    feature: {
                        magicType: {
                            show: true, type: ["line", "bar"]
                        },
                        dataView: { show: true, readOnly: false },
                        restore: { show: true },
                        saveAsImage: { show: true }
                    }
                },
                calculable: true,
                xAxis: [
                    {
                        type: "category",
                        axisLabel: {
                            interval: "auto"
                        },
                        data: ["暂无数据"]
                    }
                ],
                yAxis: [
                    {
                        type: "value"
                    }
                ],
                series: [
                    {
                        name: "实发金额",
                        type: "line",
                        smooth: true,
                        barMaxWidth: 30,
                        itemStyle: { normal: { areaStyle: { type: 'default' } } },
                        lineStyle: {
                            width: 20
                        },
                        label: {
                            normal: {
                                position: "top",
                                show: true
                            }
                        },
                        legendHoverLink: true,
                        data: [0]
                    }
                ]
            };
            PerformanceToBar.showLoading({
                text: "数据加载中，请您耐心等待..."
            });
            //异步读取数据
            $.ajax({
                url: "/SysManage/Desk/RealAmountForWeekToLine",// 跳转到 action
                type: "post",
                cache: false,
                dataType: "json",
                success: function (data) {
                    if (data != null && data["series"] != null) {
                        // ReSharper disable once ConditionIsAlwaysConst
                        if (data != null && data["series"] != null) {
                            PerformanceToBarOption.legend.data = data.legen;
                            PerformanceToBarOption.title.text = data.total;
                            PerformanceToBarOption.xAxis[0]["data"] = data.axis.Axis0;
                            PerformanceToBarOption.series[0]["data"] = data.series.Series0;
                            PerformanceToBar.setOption(PerformanceToBarOption);

                        } else {
                            PerformanceToBar.setOption(PerformanceToBarOption);
                        }

                    } else {
                        PerformanceToBar.setOption(PerformanceToBarOption);
                    }
                },
                error: function (e) {

                }, complete: function () {
                    //不管数据接口成功或异常，都终于载入提示
                    //停止动画载入提示
                    PerformanceToBar.hideLoading();
                }

            });
        }

    </script>
}
