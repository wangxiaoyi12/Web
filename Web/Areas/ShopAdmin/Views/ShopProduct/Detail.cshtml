@model DataBase.ShopProduct
@{
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}
@section css{
    <link href="~/assets/global/myplugins/Uploader/Uploader6.0.min.css" rel="stylesheet" />
    <style>
        .myImg {
            float: left;
            padding: 3px;
            margin: 3px;
        }

        .table-responsive {
            overflow: auto;
        }
    </style>
}
<!-- BEGIN PAGE BAR -->
<div class="page-bar">
    <ul class="page-breadcrumb">
        <li>
            <a href="/SysManage/Desk/Index">首页</a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="#"><span>商城管理</span></a>
            <i class="fa fa-angle-right"></i>
        </li>
        <li>
            <a href="#"><span>商品</span></a>
        </li>
    </ul>
</div>
<!-- END PAGE BAR -->
<!-- BEGIN PAGE CONTENT -->
<div class="row">
    <div class="col-md-12">
        @using (Ajax.BeginForm("Save", null, new AjaxOptions()
        {
            HttpMethod = "Post",
            OnBegin = "SubAjax.Loading",
            OnComplete = "SubAjax.Complate",
            OnFailure = "SubAjax.Failure",
            OnSuccess = "SubAjax.Success"
        }, new { @class = "form-horizontal", @role = "form", @id = "commentForm" }))
        {
            <div class="form-body">
                <div class="portlet light ">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class="font-green-sharp fa fa-user"></i>
                            <span class="caption-subject font-green-sharp bold uppercase">@ViewBag.Title<span>商品详情</span></span>
                        </div>
                    </div>
                    <div class="tabbable-custom ">
                        <ul class="nav nav-tabs">
                            @if (ViewBag.tiao != "1")
                            {
                                <li class="active">
                                    <a href="#tabs1" data-toggle="tab"> 基本信息 </a>
                                </li>
                            }
                            else
                            {
                                <li>
                                    <a href="#tabs1" data-toggle="tab"> 基本信息 </a>
                                </li>
                            }
                            <li>
                                <a href="#tabs2" data-toggle="tab" style="display:none"> 商品价格 </a>
                            </li>
                            <li>
                                <a href="#tabs3" data-toggle="tab"> 详情描述 </a>
                            </li>
                            <li>
                                <a href="#tabs4" data-toggle="tab"> 商品相册 </a>
                            </li>
                            @if (ViewBag.tiao == "1")
                            {
                                <li class="active">
                                    <a href="#tabs5" data-toggle="tab"> 尺码/规格  </a>
                                </li>
                            }
                            else
                            {
                                <li>
                                    <a href="#tabs5" data-toggle="tab"> 尺码/规格  </a>
                                </li>
                            }
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane  @(ViewBag.tiao=="1"?"":"active")" id="tabs1">
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red">*</span>商品标题：</label>
                                    <input type="hidden" name="ID" id="ID" value="@Model.ID" />
                                    <div class="col-md-4">
                                        <input type="hidden" name="ID" value="@Model.ID" />
                                        <input type="hidden" name="ShopID" value="@Model.ShopID" />
                                        <input type="text" name="Title" value="@Model.Title" class="form-control" nullmsg="请输入商品标题" datatype="*1-100" errormsg="商品标题不正确">
                                    </div>
                                    <span></span>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>副标题：</label>
                                    <div class="col-md-4">
                                        <input type="text" name="SubTitle" value="@Model.SubTitle" class="form-control" nullmsg="请输入副标题" datatype="*0-100" errormsg="副标题不正确">
                                    </div>
                                    <span></span>
                                </div>
                                @*@if (ViewBag.code == "admin")
                                    {*@
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red">*</span>商品类别：</label>
                                    <div class="col-md-2">
                                        <select id="category" name="CategoryID1" onchange="changeC1()" class="form-control select2" datatype="*">
                                            <option value="">请选择...</option>
                                            @{
                                                foreach (KeyValuePair<int, string> item in ViewBag.List1)
                                                {
                                                    if (ViewBag.C1 == item.Key)
                                                    {
                                                        <option value="@item.Key" selected="selected">@item.Value</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@item.Key">@item.Value</option>
                                                    }
                                                }
                                            }
                                        </select>


                                    </div>

                                    <div class="col-md-2">
                                        <select id="category2" name="CategoryID" onchange="changeC2()" class="form-control select2" datatype="*">
                                            <option value="">请选择...</option>
                                            @*@{
                                                    foreach (KeyValuePair<int, string> item in ViewBag.List)
                                                    {
                                                        if (Model.CategoryID == item.Key)
                                                        {
                                                            <option value="@item.Key" selected="selected">@item.Value</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@item.Key">@item.Value</option>
                                                        }
                                                    }
                                                }*@
                                        </select>
                                    </div>
                                    <span></span>
                                </div>
                                @*}
                                    else
                                    {
                                        <div class="form-group">
                                            <label class="col-md-2 control-label"><span style="color:red">*</span>商品类别：</label>
                                            <div class="col-md-2">
                                                <select id="category" name="CategoryID1" onchange="changeC1()" class="form-control select2" datatype="*">
                                                    <option value="">请选择...</option>
                                                    @{
                                                        foreach (KeyValuePair<int, string> item in ViewBag.List8)
                                                        {
                                                            if (ViewBag.C1 == item.Key)
                                                            {
                                                                <option value="@item.Key" selected="selected">@item.Value</option>
                                                            }
                                                            else
                                                            {
                                                                <option value="@item.Key">@item.Value</option>
                                                            }
                                                        }
                                                    }
                                                </select>


                                            </div>

                                            <div class="col-md-2">
                                                <select id="category2" name="CategoryID" class="form-control select2" datatype="*">
                                                    <option value="">请选择...</option>
                                                </select>
                                            </div>
                                            <span></span>
                                        </div>
                                                        }*@
                                @*<div class="form-group">
                                        <label class="col-md-2 control-label"><span style="color:red"></span>所属品牌：</label>
                                        <div class="col-md-4">
                                            <select name="BrandID" class="form-control select2">
                                                <option value="">请选择...</option>
                                                @{
                                                    foreach (KeyValuePair<int, string> item in ViewBag.Brand)
                                                    {
                                                        if (Model.BrandID == item.Key)
                                                        {
                                                            <option value="@item.Key" selected="selected">@item.Value</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@item.Key">@item.Value</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>
                                        <span></span>
                                    </div>*@

                                <div class="form-group ">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>运费：</label>
                                    <div class="col-md-2 ">
                                        <input type="text" name="Postage"
                                               value="@Model.Postage" class="form-control" nullmsg="请输入运费" datatype="*0-20">
                                    </div>
                                    <span></span>
                                </div>

                                <div class="form-group" id="CT">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>参团人数：</label>
                                    <div class="col-md-4">
                                        <input type="text" name="Inventory" value="@Model.Inventory" class="form-control" nullmsg="请输入参团人数" datatype="n0-20">
                                    </div>
                                    <span></span>
                                </div>
                                <div class="form-group" id="BiLi">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>参团比例('|'分割)：</label>
                                    <div class="col-md-4">
                                        <input type="text" name="CanTuanBiLi" value="@Model.CanTuanBiLi" class="form-control" nullmsg="请输入参团比例">
                                    </div>
                                    <span></span>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>顺序：</label>
                                    <div class="col-md-4">
                                        <input type="text" name="Sort" value="@Model.Sort" class="form-control" nullmsg="请输入顺序" datatype="n1-20" errormsg="顺序不正确">
                                    </div>
                                    <span></span>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>发布时间：</label>
                                    <div class="col-md-4">
                                        <input type="text" name="CreateTime" id="CreateTime" value="@(Model.CreateTime.ToString("yyyy-MM-dd"))" class="form-control" nullmsg="请输入发布时间">
                                    </div>
                                    <span></span>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>商品特性：</label>
                                    <div class="col-md-6 col-sm-8">
                                        <div class="col-md-3">
                                            <label>
                                                <input type="checkbox" name="IsEnable" value="True" @(Model.IsEnable == true ? "checked=\"checked\")" : "")> 上架
                                            </label>
                                        </div>
                                        <div class="col-md-3">
                                            <label>
                                                <input type="checkbox" name="IsRecommend" value="True" @(Model.IsRecommend == true ? "checked=\"checked\")" : "")> 推荐
                                            </label>
                                        </div>
                                        @*<div class="col-md-3">
                                                <label>
                                                    <input type="checkbox" name="IsNew" value="True" @(Model.IsNew == true ? "checked=\"checked\")" : "")> 活动专区
                                                </label>
                                            </div>*@
                                        @*<div class="col-md-3">
                                                <label>
                                                    <input type="checkbox" name="IsHot" value="True" @(Model.IsHot == true ? "checked=\"checked\")" : "")> 点赞商品
                                                </label>
                                            </div>*@
                                    </div>
                                    <span></span>
                                </div>
                            </div>


                            @*<div class="tab-pane" id="tabs2">
                                    <div class="form-group">
                                        <label class="col-md-2 control-label"><span style="color:red"></span>原价：</label>
                                        <div class="col-md-4">
                                            <input type="text" name="PriceOriginal" value="@Model.PriceOriginal" class="form-control" nullmsg="请输入原价" datatype="*0-20">
                                        </div>
                                        <span></span>
                                    </div>
                                    <div class="form-group ">
                                        <label class="col-md-2 control-label"><span style="color:red"></span>零售价：</label>
                                        <div class="col-md-4">
                                            <input type="text" name="PriceShopping" value="@Model.PriceShopping" class="form-control" nullmsg="请输入订购价" datatype="*0-20">
                                        </div>
                                        <span></span>
                                    </div>
                                    <div class="form-group">
                                            <label class="col-md-2 control-label"><span style="color:red"></span>优惠价：</label>
                                            <div class="col-md-4">
                                                <input type="text" name="PV" value="@Model.PV" class="form-control" placeholder="请输入优惠价" datatype="*0-20">
                                            </div>
                                            <span></span>
                                        </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label"><span style="color:red"></span>配货价：</label>
                                        <div class="col-md-4">
                                            <input type="text" name="PriceScore" id="PriceScore" value="@Model.PriceScore" class="form-control" placeholder="请输入配货价" datatype="*0-20">
                                        </div>
                                        <span></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label"><span style="color:red"></span>推广奖：</label>
                                        <div class="col-md-4">
                                            <input type="text" name="TuiJian" id="TuiJian" value="@Model.TuiJian" class="form-control" placeholder="请输入推广奖" datatype="*0-20">
                                        </div>
                                        <span></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-2 control-label"><span style="color:red"></span>一代平级奖：</label>
                                        <div class="col-md-4">
                                            <input type="text" name="YongJin1" id="YongJin1" value="@Model.YongJin1" class="form-control" placeholder="请输入一代平级奖" datatype="*0-20">
                                        </div>
                                        <span></span>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-md-2 control-label"><span style="color:red"></span>二代平级奖：</label>
                                        <div class="col-md-4">
                                            <input type="text" name="YongJin2" id="YongJin2" value="@Model.YongJin2" class="form-control" placeholder="请输入二代平级奖" datatype="*0-20">
                                        </div>
                                        <span></span>
                                    </div>

                                </div>*@
                            <div class="tab-pane" id="tabs3">
                                @*<div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>活动展示：</label>
                                    <div class="col-md-10">
                                        <textarea name="Activity" rows="3" class="form-control" nullmsg="如果是活动产品，请输入活动描述">@Model.Activity</textarea>
                                    </div>
                                    <span></span>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>商品简介：</label>
                                    <div class="col-md-10">
                                        <textarea name="Description" rows="3" class="form-control" nullmsg="请输入商品简介">@Model.Description</textarea>
                                    </div>
                                    <span></span>
                                </div>*@
                                <div class="form-group">
                                    <label class="col-md-2 control-label"><span style="color:red"></span>详细描述：</label>
                                    <div class="col-md-10">
                                        <textarea name="Content" style="height:400px" id="content"></textarea>
                                    </div>
                                    <span></span>
                                </div>
                            </div>

                            <div class="tab-pane" id="tabs4">
                                <div class="panel panel-success">
                                    <div class="panel-body">
                                        <p>
                                            <div class="uploader uploader-warning" id="uploadBtn2"></div>
                                            <input type="hidden" id="imgpath1" name="imgpath1" value="@ViewBag.imgpath1" />
                                            <input type="hidden" id="imgpath2" name="imgpath2" value="@ViewBag.imgpath2" />
                                        </p>
                                        <div class="imgrow">
                                            @Html.Raw(ViewBag.SB)
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane @(ViewBag.tiao=="1"?"active":"")" id="tabs5">
                                <div class="panel panel-success">
                                    <div class="panel-body">

                                        <div id="compareyear" style="width:80%;margin-left:19%"> </div>
                                        <div style="width:80%;margin-left:10%">
                                            <div class="form-group">
                                                <label class="col-md-2 control-label"><span style="color:red">*</span>零售价：</label>
                                                <div class="col-md-4">
                                                    <input type="text" name="LingShou" id="LingShou" value="0" class="form-control" nullmsg="请输入零售价" datatype="*0-20">
                                                </div>
                                                <span></span>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-2 control-label"><span style="color:red">*</span>会员价：</label>
                                                <div class="col-md-4">
                                                    <input type="text" name="YouHui" id="YouHui" value="0" class="form-control" nullmsg="请输入优惠价" datatype="*0-20">
                                                </div>
                                                <span></span>
                                            </div>



                                            <div class="form-group">
                                                <label class="col-md-2 control-label"><span style="color:red"></span>PV值：</label>
                                                <div class="col-md-4">
                                                    <input type="text" name="PeiHuo" id="PeiHuo" value="0" class="form-control" nullmsg="请输入配货价" datatype="*0-20">
                                                </div>
                                                <span></span>
                                            </div>


                                            <div class="form-group">
                                                <label class="col-md-2 control-label"><span style="color:red">*</span>库存：</label>
                                                <div class="col-md-4">
                                                    <input type="text" name="KuCun" id="KuCun" value="0" class="form-control" nullmsg="请输入库存" datatype="*0-20">
                                                </div>
                                                <span></span>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-2 control-label"><span style="color:red"></span>已售数量：</label>
                                                <div class="col-md-4">
                                                    <input type="text" name="YiShou" id="YiShou" value="0" class="form-control" nullmsg="请输入已售数量" datatype="*0-20">
                                                </div><a onclick="FuTou1('Z')" class="btn green"><i class="fa fa-check"></i><span>上传规格</span></a>
                                                <span></span>
                                            </div>



                                        </div>
                                    </div>
                                </div>

                                <div class="portlet-body">
                                    <div class="table-responsive">
                                        <div class="table-toolbar col-md-12">
                                            <div class="btn-group">

                                                <a id="delete" onclick="_deleteLists()" class="btn red">
                                                    <i class="fa fa-trash-o"></i> 删除
                                                </a>
                                            </div>
                                        </div>
                                        <form class="form form-horizontal form-inline">
                                            <fieldset>
                                                <div class="control-group">
                                                    <div class="controls">
                                                        <div class="text-right">

                                                        </div>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>
                                    <div class="table-responsive" width="100%">
                                        <table id="datatable" class="table table-striped table-hover table-bordered" style="width: 100%;overflow-x:auto">
                                            <thead>
                                                <tr>
                                                    <th style="width:3%"><input type="checkbox" id='checkAll'></th>

                                                    <th>规格</th>

                                                    <th>零售价</th>
                                                    <th>会员价</th>
                                                    <th>PV值</th>

                                                    <th>库存</th>
                                                    <th>已售</th>
                                                    <th>操作</th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                                @{
                                                    if (ViewBag.GG != null)
                                                    {
                                                        foreach (var item in ViewBag.GG as List<DataBase.GuiGeProduct_Info>)
                                                        {
                                                            <tr>
                                                                <td align="center">
                                                                    <input type="checkbox" value="@item.GGId" ID="chkId" CssClass="checkall" name="chkName" style="vertical-align: middle;" />
                                                                    <input type="hidden" ID="hidId" Value='@item.GGId' name="GGId" />
                                                                </td>
                                                                <td>@item.SComment</td>
                                                                <td><input type="text" value="@item.LingShou" id='LingShou_@item.GGId' /></td>
                                                                <td><input type="text" value="@item.YouHui" id='YouHui_@item.GGId' /></td>
                                                                <td><input type="text" value="@item.PeiHuo" id='PeiHuo_@item.GGId' /></td>


                                                                <td><input type="text" value="@item.KuCun" id='KuCun_@item.GGId' /></td>
                                                                <td><input type="text" value="@item.YiShou" id='YiShou_@item.GGId' /></td>
                                                                <td><a onclick="saveData('@item.GGId')" class='btn green btn-xs'>保存</a></td>
                                                            </tr>
                                                        }
                                                    }
                                                }
                                            </tbody>
                                        </table>

                                    </div>
                                </div>



                            </div>

                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <div class="row">
                        <div class="col-md-offset-3 col-md-9">
                            <button type="submit" id="SubSave" class="btn green"><i class="fa fa-check"></i><span>保 存</span></button>
                            <button type="button" class="btn default" onclick="window.history.back()"><i class="fa fa-mail-reply"></i>返回</button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<!-- END PAGE CONTENT -->
@section scripts{
    <script src="~/assets/global/plugins/UEditor/ueditor.config.js"></script>
    <script src="~/assets/global/plugins/UEditor/ueditor.all.min.js"></script>


    <script src="~/assets/global/myplugins/Uploader/Uploader6.0.min.js"></script>

    <script>


        function saveData(row) {
            var LingShou = $("#LingShou_" + row).val();
            var YouHui = $("#YouHui_" + row).val();
            var KuCun = $("#KuCun_" + row).val();
            var YiShou = $("#YiShou_" + row).val();
            var PeiHuo = $("#PeiHuo_" + row).val();




            //alert(row + " " + LingShou + YouHui + KuCun + YiShou)
            $.post("/shopadmin/shopproduct/SaveData", {
                id: row, LingShou: LingShou, YouHui: YouHui, PeiHuo: PeiHuo, KuCun: KuCun, YiShou: YiShou

            }, function (result) {
                alert("操作提示", "修改成功", function () {
                    location.href = '/shopadmin/shopproduct/detail?id=' + $("#ID").val() + '&tiao=1';
                })
            });
        }


        var ue = UE.getEditor('content');
        ue.ready(function () {
            //设置编辑器的内容
            var html = '@Html.Raw(Model.Content)';
            ue.setContent(html);
            console.info(html);
        });
        $(function () {
            $('#CreateTime').datetimepicker({
                language: 'zh-CN',
                format: 'yyyy-mm-dd',
                autoclose: 1,
                minView: 2
            })
            changeC1();
            changeC2();
            //绑定包邮，选择
            $('input[name="IsPotagte"]').change(function () {
                var val = $(this).val();
                console.info(val);
                if (val == 'True') {
                    $(this).parents('.form-group').find(':text').hide();
                } else {
                    $(this).parents('.form-group').find(':text').show();
                }
            });
        });



        function changeC1() {
            var id = $("#category").val();
         
            $('#category2').empty();
            if (id ==@DB.XmlConfig.XmlSite.Scores) {
                $("#CT").show();
                $("#BiLi").show();
            } else {
                $("#CT").hide();
                $("#BiLi").hide();
            }
          
            $.post("/Ajax/GetCategory2", { id: id }, function (d) {
                $("#category2").select2({
                    data: d, cache: true
                });

                $("#category2").select2('val', ['@Model.CategoryID']);


            })


        }
        var b = 0;
        function changeC2() {

            var str = "<span style='color: red'>*</span>";

            //变动下拉框
            var id = $("#category2").val();
            $('#SName').empty();
            $('#SComment').empty();
            $.post("/Ajax/GetGuiGe", { id: id }, function (obj) {
                b = 0;
                for (var i = 0; i < obj.length; i++) {
                    var yearArray = new Array();

                    yearArray = obj[i].split(",");
                    for (var c = 0; c < yearArray.length; c++) {
                        if (c == 1) {
                            str += "<label style='font-size:13px;margin-right:30px'>" + yearArray[c] + ":   </label>";
                            b++;
                        }
                        else if (c > 1) {
                            str += "<label style='font-size:13px'><input type='radio' name='checkbox" + yearArray[0] + "' id='checkbox'    value='" + yearArray[c] + "' />" + yearArray[c] + "   </label>";
                        }

                    }
                    str += "<br/><br/>"
                }

                $("#compareyear").html(str);
            })

        }


        function FuTou1(type) {
            confirm("确认!", "确定要此操作吗", function () {
                var LingShou = $("#LingShou").val();
                var YouHui = $("#YouHui").val();
                var KuCun = $("#KuCun").val();
                var YiShou = $("#YiShou").val();
                var PeiHuo = $("#PeiHuo").val();



                var str = "";

                var c = 0;
                $("input[id='checkbox']:checked").each(function (i, o) {
                    str += $(this).val();
                    str += ",";
                    c++;
                });
                //alert(b+"  "+c)
                if (b != c) {
                    alert("操作提示", "请选择完整规格");
                    return;
                }
                if (str.length > 0) {
                    var str = str.substr(0, str.length - 1);
                    //alert($("#ID").val());
                    $.ajax({
                        url: "/shopadmin/shopproduct/addguige",
                        data: {
                            LingShou: LingShou, YouHui: YouHui, PeiHuo: PeiHuo, KuCun: KuCun, YiShou: YiShou,
                            str: str, productid: $("#ID").val(), SName: $("#category2").val()
                        },
                        type: "post",
                        success: function (backdata) {


                            if (backdata.IsSuccess == true) {
                                alert("操作提示", "增加成功", function () {
                                    location.href = '/shopadmin/shopproduct/detail?id=' + $("#ID").val() + '&tiao=1';
                                })
                            } else {
                                alert("操作提示", backdata.Msg, function () {
                                    //location.href = '/shopadmin/shopproduct/detail?id=' + $("#ID").val() + '&tiao=1';
                                })
                            }

                        }, error: function (error) {
                            console.log(error);
                        }
                    });

                    //oTable.ajax.reload()
                } else if (str.length == 0) {
                    alert("操作提示", "请选择规格");
                }


                //$.ajax({
                //    url: "/shopadmin/shopproduct/addguige",
                //    data: { PId: $("#ID").val(), GuiGe: GuiGe },
                //    type: "post",
                //    success: function (backdata) {

                //        alert("操作提示", "增加成功", function () {
                //            location.href = '/shopadmin/shopproduct/detail?id=' + $("#ID").val() + '&tiao=1';
                //        })

                //    }, error: function (error) {
                //        console.log(error);
                //    }
                //});
            });
        }

        function _deleteFun(id) {
            var url = window.location.href.split("?")[0].toLowerCase();
            if (url.lastIndexOf("/index") > 0) {
                url = url.substring(0, url.indexOf("/index"));
            }
            url = "/shopadmin/shopproduct/GGDelete";
            confirm("删除确认!", "删除记录后不可恢复，您确定吗？", function () {
                $.ajax({
                    url: url,
                    data: { idList: id },
                    type: "post",
                    success: function (backdata) {
                        alert("成功提示", backdata.Msg)
                        $("#checkAll").prop("checked", false);
                        location.href = '/shopadmin/shopproduct/detail?id=' + $("#ID").val() + '&tiao=1';
                    }, error: function (error) {
                        console.log(error);
                    }
                });
            })
        }

        /**
        * 批量删除（可复制）
        * param id list
        * private
        */
        function _deleteLists() {
            var str = "";
            $("input[name='chkName']:checked").each(function (i, o) {
                str += $(this).val();
                str += ",";
            });
            if (str.length > 0) {
                var IDS = str.substr(0, str.length - 1);
                _deleteFun(IDS);
                //location.href = '/shopadmin/shopproduct/detail?id=' + $("#ID").val() + '&tiao=1';
            } else {
                alert("操作提示", "至少选择一条记录操作");
            }
        }
        //删除一张图片
        var img_i = 0;
        /**大小图片前台处理，后台简单处理模式，上传成功后显示图片**/
        var uploader = $('#uploadBtn2').uploader({
            url: 'ws://@(Request.Url.Host):@(Request.Url.Port)/ajax/upload',
            fileExts: 'jpg;png',
            text: '产品图片上传',
            more: true,//是否可以上传多个
            auto: true, //是否自动上传
            debug: false,
            type: 'imgdouble',
            minWidth: 200,
            minHeight: 200,
            maxWidth: 900,
            maxHeight: 700,
            handleType: '0',//对于大小图模式最好不要自动处理
            subfolder: 'upload/product',
            onSuccess: function (data) {
                img_i++;
                //添加到列表,每个图片上传成功都会触发
                var row = $('.imgrow');
                var img1 = data.big.relativeName;
                var img2 = data.small.relativeName;
                $("#imgpath1").val($("#imgpath1").val() + img1 + "&");
                $("#imgpath2").val($("#imgpath2").val() + img2 + "&");
                var appendtext = '<div class="myImg divimg' + img_i + '"><div style="position:absolute"><a href="javascript:deleteimg(\'' + img1 + '\',\'' + img2 + '\',' + img_i + ')" class="btn red"><i class="fa fa-remove"></i></a></div><div><img src="' + data.small.relativeName + '" /></div></div>';
                row.append(appendtext);
            }
        });
        function deleteimg(img1, img2, n) {
            var imgs1 = $("#imgpath1").val();
            var imgs2 = $("#imgpath2").val();
            $("#imgpath1").val(imgs1.replace(img1 + "&", ""));
            $("#imgpath2").val(imgs2.replace(img2 + "&", ""));
            $(".divimg" + n).remove();
        }
    </script>
}